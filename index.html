<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title></title>
</head>
<body>
    <div>
        <p>UQDWLxE1akNmxQTTQsWmtnFMFAnJcGGR2iOmYw62IRdhC077</p>
    </div>
	<!-- <div id="ton-connect"></div> -->

    <button id="connect-btn">Connect</button>
    <button id="disconnect-btn">Disconnect</button>

    <div id="relayMessage"></div>
    <!-- <button id="send-btn">Send</button>  -->
</body>
<script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
<script>
    const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
        manifestUrl: 'https://win0110.xyz/tonconnect-manifest.json',
        // buttonRootId: 'ton-connect'
    });

    tonConnectUI.uiOptions = {
        twaReturnUrl: 'https://t.me/wallet_connect_deposit_bot'
    };

    const currentWallet = tonConnectUI.wallet;

    console.log('currentWallet', currentWallet);
    if(currentWallet) {
        document.getElementById('connect-btn').style.display = 'none';
    }else{
        document.getElementById('disconnect-btn').style.display = 'none';
    }

    const unsubscribe = tonConnectUI.onStatusChange(
        walletAndwalletInfo => {
            // update state/reactive variables to show updates in the ui
            console.log('walletAndwalletInfo', walletAndwalletInfo);
            if(walletAndwalletInfo) {
                document.getElementById('connect-btn').style.display = 'none';
                document.getElementById('disconnect-btn').style.display = 'block';
            }else{
                document.getElementById('connect-btn').style.display = 'block';
                document.getElementById('disconnect-btn').style.display = 'none';
            }
        }
    );

    

    async function connectToWallet() {
        relayMessage('Relay started...', 0);
        
        const connectedWallet = await tonConnectUI.connectWallet();

        // const transaction = {
        //     validUntil: Math.floor(Date.now() / 1000) + 60,
        //     messages: [
        //         {
        //             address: "UQDWLxE1akNmxQTTQsWmtnFMFAnJcGGR2iOmYw62IRdhC077", // destination address
        //             amount: "20000000" //Toncoin in nanotons
        //         }
        //     ]
        // };

        // await tonConnectUI.sendTransaction(transaction);

        //console.log(connectedWallet);
        setTimeout(function() {
            relayMessage('2 seconds passed...', 2000);
        }, 2000);
    }

    function relayMessage(message, delay) {
        setTimeout(function() {
            document.getElementById('relayMessage').innerText = message;
        }, delay);
    }
    
    document.getElementById("connect-btn").addEventListener('click', async () => {
        // Call the function
        connectToWallet().catch(error => {
            console.error("Error connecting to wallet:", error);
        });
    });
    
    // document.getElementById("send-btn").addEventListener('click', async () => {
    //     
    
    //     const result = await tonConnectUI.sendTransaction(transaction);
    // });

    document.getElementById("disconnect-btn").addEventListener('click', async () => {
        await tonConnectUI.disconnect();
    });
</script>
</html>