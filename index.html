<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title></title>
</head>
<body>
    <div>
        <p>UQDWLxE1akNmxQTTQsWmtnFMFAnJcGGR2iOmYw62IRdhC077</p>
    </div>
	<div id="ton-connect" style="display: none;"></div>

    <button id="connect-btn">Connect</button>
    <button id="disconnect-btn">Disconnect</button>
    <!-- <button id="send-btn">Send</button>  -->
</body>
<script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
<script>
    const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
        manifestUrl: 'https://win0110.xyz/tonconnect-manifest.json',
        buttonRootId: 'ton-connect'
    });

    tonConnectUI.uiOptions = {
        twaReturnUrl: 'https://t.me/bot'
    };

    const currentWallet = tonConnectUI.wallet;
    console.log('currentWallet', currentWallet);
    if(currentWallet) {
        document.getElementById('connect-btn').style.display = 'none';
    }else{
        document.getElementById('disconnect-btn').style.display = 'none';
    }

    const unsubscribe = tonConnectUI.onStatusChange(
        walletAndwalletInfo => {
            // update state/reactive variables to show updates in the ui
            console.log('walletAndwalletInfo', walletAndwalletInfo);
            if(walletAndwalletInfo) {
                document.getElementById('connect-btn').style.display = 'none';
                document.getElementById('disconnect-btn').style.display = 'block';
            }else{
                document.getElementById('connect-btn').style.display = 'block';
                document.getElementById('disconnect-btn').style.display = 'none';
            }
        }
    );

    async function connectToWallet() {
        const connectedWallet = await tonConnectUI.connectWallet();
        document.getElementById('connect-btn').style.display = 'none';
        document.getElementById('disconnect-btn').style.display = 'block';
        setTimeout(async () => {
            // Do something with connectedWallet if needed
            const transaction = {
                validUntil: Math.floor(Date.now() / 1000) + 60,
                messages: [
                    {
                        address: "UQDWLxE1akNmxQTTQsWmtnFMFAnJcGGR2iOmYw62IRdhC077", // destination address
                        amount: "20000000" //Toncoin in nanotons
                    }
                ]
            };
        
            const result = await tonConnectUI.sendTransaction(transaction);
        }, 3000);
        // console.log(connectedWallet);
    }
    
    document.getElementById("connect-btn").addEventListener('click', async () => {
        // Call the function
        connectToWallet().catch(error => {
            console.error("Error connecting to wallet:", error);
        });
    });
    
    // document.getElementById("send-btn").addEventListener('click', async () => {
    //     const transaction = {
    //         validUntil: Math.floor(Date.now() / 1000) + 60,
    //         messages: [
    //             {
    //                 address: "UQDWLxE1akNmxQTTQsWmtnFMFAnJcGGR2iOmYw62IRdhC077", // destination address
    //                 amount: "20000000" //Toncoin in nanotons
    //             }
    //         ]
    //     };
    
    //     const result = await tonConnectUI.sendTransaction(transaction);
    // });

    document.getElementById("disconnect-btn").addEventListener('click', async () => {
        await tonConnectUI.disconnect();
        document.getElementById('connect-btn').style.display = 'block';
        document.getElementById('disconnect-btn').style.display = 'none';
    });
</script>
</html>